<!doctype html>
<html>
<head>
	<title>xi4n Documentation</title>
	<link href="styles.css" rel="stylesheet">
	<script src="intro.min.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
<div id="wrapper">
	<nav>	
		<dl>
			<dt><a href="#top">xi4n</a></dt>
				<dd>0.1.0-unstable</dd>
			<dt><a href="#what">What?</a></dt>
				<dd><a href="#what-detail">No, really? What is it?</a></dd>
				<dd><a href="#what-features">Features</a></dd>
			<dt><a href="#getting-started">Getting started</a></dt>
				<dd><a href="#getting-started-tlwr">Too Lazy; Won't Read?</a></dd>
				<dd><a href="#getting-started-first">Stuff you need first</a></dd>
				<dd><a href="#getting-started-install">Installing</a></dd>
				<dd><a href="#getting-started-create-config">Creating a
				configuration</a></dd>
				<dd><a href="#getting-started-run-config">Running the configuration</a></dd>
				<dd><a href="#getting-started-now-what">Where to go next?</a></dd>
				<dd><a href="#getting-started-upgrading">Upgrading to newer
				versions</a></dd>
			<dt><a href="#plugins">Plugins? Plugins!</a></dt>
				<dd><a href="#plugins-what">What?</a></dd>
				<dd><a href="#plugins-included">Included plugins</a></dd>
				<dd><a href="#plugins-writing">Writing plugins</a></dd>
			<dt><a href="#config">Configuration File Anatomy</a></dt>
				<dd><a href="#config-yaml">YAML?</a></dd>
				<dd><a href="#config-tour">Tour</a></dd>
				<dd><a href="#config-reference">Reference</a></dd>
			<dt><a href="#library">Library usage</a></dt>
				<dd><a href="#library-api">API</a></dd>
			<dt><a href="#contributing">Contributing</a></dt>
				<dd><a href="#contributing-guide">Guide</a></dd>
		</dl>
	</nav>

	<div id="contentWrapper">
		<h1 id="mainHeader">xi4n Documentation</h1>
		<h2 id="introText">0.1.0-unstable</h2>

		<article id="what">
			<h1>What?</h1>
			<p>An awesomely unintelligible acronym.</p>
			<h2 id="what-detail">No, really? What is it?</h2>
			<p>xi4n is a cross platform (Linux, Windows, OS X, FreeBSD,
			Solaris), plugin based application to help write multi-server/client
			InSim, Outgauge and Outsim applications in javascript, on top of
			nodejs.</p>
			<p>In more basic terms, xi4n allows you to interact with Live For
			Speed servers and clients, and manipulate the behaviour of the
			game.</p>

			<h2 id="what-features">Features</h2>
			<ul>
				<li>Supports InSim, Outgauge, OutSim and LFS World</li>
				<li>Automatic reconnection</li>
				<li>Supports client or server</li>
				<li>Multiple concurrent connections</li>
				<li>Shared information between connections</li>
				<li>Multiple plugins per connection</li>
				<li>May be used as a library, rather than as a application</li>
				<li>The whole freaking library of <a 
					href="http://npmjs.org">node modules</a></li>
			</ul>
		</article>

		<article id="getting-started">
            <h1>Getting started</h1>
            <h2 id="getting-started-tlwr">Too Lazy; Won't Read? <small>gifs with sound!1one</small></h2>
            <p>Too lazy to read? We've got a setup video for 0.1.0.</p>
            <p><strong>TODO</strong></p>

			<h2 id="getting-started-first">Stuff you need first</h2>
			<ul>
				<li>A working LFS dedicated server, or LFS client installation</li>
				<li>A working <a href="http://nodejs.org/">nodejs</a> installation</li>
				<li>A text editor</li>
				<li>And finally, if you wish to write plugins, familiarity with Javascript and its idiocracies</li>
			</ul>
			<h2 id="getting-started-install">Installing</h2>
			<ol>
				<li>Ensure that you've met the <a href="#getting-started-first">prerequisites</a></li>
				<li>From a command line interface run (on Windows that's cmd, on
				OSX Terminal, and on Linux you probably already know): <pre
				data-type="bash"><code>npm install xi4n -g</code></pre></li>
				<li>If everything went successfully, you will now be able to run
				<pre><code>xi4n --help</code></pre> from a command line interface</li>
				<li>Congratulate yourself on a job well done</li>
			</ol>
			<h2 id="getting-started-create-config">Creating a configuration</h2>
			<p>The configuration is important. Without a configuration xi4n sits
			there and does nothing. With a configuration you can tell xi4n what
			to do and where to do it.</p>
			<ol>
				<li>The first step is to create a configuration and plugin
				directory. This is where your custom configuration and
				plugins will live. Run
				<pre><code>xi4n init test</code></pre></li>
				<li>You should now see a directory called test Head in there and
				you should find config.yaml, a plugins directory and a README
				file.
				</li>
			</ol>
			<p>Go and checkout config.yaml and the plugins directory. The
			default configuration connects to your local system, on port 29999,
			with no admin password. If this doesn't match what you're intending
			to do, go and edit the file as appropriate.</p>
			<h2 id="getting-started-run-config">Running the configuration</h2>
			<ol>
				<li>First we need to start an instance of LFS and enable InSim
				<ul>
					<li>For a server the easiest thing to do is to edit your server's .cfg file and set the /insim port and /admin password. Ensure that the line are not commented out. 29999 is the default InSim port. You MUST set the admin password as well</li>
					<li>For a client you can either add /insim=29999 as a
					argument to the LFS shortcut/executable or open a chat prompt when running LFS, and type "/insim=29999". 29999 is the default port for InSim, but you may type anything greater than 1024 and less than 65335, and as long as it's not in use it should be fine</li>
				</ul>
				</li>
				<li>Now start xi4n
				<pre><code>xi4n start test</code></pre> (If
				you're already in the directory of your xi4n config, you can
				skip the directory name, or if you're far away from it you can
				specify the absolute path! In this instance 'test' is the
				directory.)</li>
				<li>Enjoy your xi4n instance. If you want to quit out xi4n prematurely press ctrl+c to close it</li>
			</ol>
			<h2 id="getting-started-now-what">Where to go next?</h2>
			<p>Out of the box, the default configuration does very little. It's
			entirely upto you what you do. If you're planning on writing your
			own plugins checkout the docs on <a href="#plugins-writing">writing plugins</a>
			below.</p>
			<p>If you just want to use a plugin, you probably want to read up on
			the <a href="#config">configuration file</a> and the <a
				href="#plugins-included">included plugins</a>.</p>

			<h2 id="getting-started-upgrading">Upgrading to newer versions
			<small>We try not to break stuff, but sometimes it has to happen for
			progress</small></h2>
			<p>Prior to 0.1.0 xi4n was architecturally very different. If you're
			running an older version I highly recommend creating a new
			configuration and porting across your settings.</p>
			<p>Upgrading between versions >=0.1.0 should be a lot easier, simply
			just a case of running the following in a command line interface,
			and restarting xi4n.</p>
			<pre data-type="bash"><code>npm upgrade xi4n -g</code></pre>
			</article>

			<article id="plugins">
			<h1>Plugins? Plugins!</h1>
			<h2 id="plugins-what">What?</h2>
			<p>Plugins are the heart of xi4n.</p>
			<p>By itself xi4n does very little other than maintain a connection
			to LFS. A plugin listens for events generated by xi4n's connection
			to LFS and performs actions accordingly.</p>
			<p>This can range from cancelling votes, to drawing buttons
			on-screen, to changing track. It's all down to what you want to do.</p>
			<h2 id="plugins-included">Included plugins</h2>
			<p>By default if you use any of the following plugins in your
			config.yaml, they'll automatically be found and and included.</p>
			<table border="0" class="table table-striped">
				<thead>
					<tr>
						<th>Name/Path</th>
						<th>And it does?</th>
						<th>Requires</th>
						<th>Options</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>busy</td><td>An anti-idler plugin</td><td></td><td></td>
					</tr>
					<tr>
						<td>gauges</td><td>An outgauge plugin that draws a
							beatiful gauge on a webpage, representing whats
							happening on the car you're driving (in real
							time)</td><td></td><td></td>
					</tr>
					<tr>
						<td>livemap2</td><td>A live tracker map, that displays
							on a web page, the live positions of racers (in real
							time)</td><td>state</td><td><ul>
								<li>http-port: port number to run the web server
								on</li>
							</ul></td>
					</tr>
					<tr>
						<td>veto</td><td>An anti-vote plugin</td><td></td>
					</tr>
					<tr>
						<td>powered-by-text</td><td>A small example plugin, that
							shows how to display text when someone connects to a
							server</td><td></td><td></td>
					</tr>
					<tr>
						<td>powered-by-buttons</td><td>A small example plugin,
							that shows how to display a button that auto-hides
							when someone connects to a server</td><td></td><td></td>
					</tr>
					<tr>
						<td>state</td><td>A "meta" plugin that maintains a
							definition of the current state of LFS including
							players, connections and server state (weather,
							track, etc.) - many plugins will probably depend on this, 
							typically you will most	likely be asked to add the plugin, 
							but do nothing else with it.</td><td></td><td></td>
                    </tr>
					<tr>
						<td>slmbr</td><td>A joke InSim application, that rewards
                        players for not moving.</td><td>state</td><td><ul>
                                <li>db: path to database file (<a
                                href="https://github.com/felixge/node-dirty">dirty</a> database)</li>
							</ul></td>
					</tr>
					<tr>
						<td>tv</td><td>A Work In Progress automatic TV director
                            </td><td>state</td></td>
					</tr>
				</tbody>
			</table>
			<h2 id="plugins-writing">Writing plugins <small>You know Javascript, right?</small></h2>
			<p>Seriously, you do need to know Javascript and it's
            idiosyncrasies. Particularly how <a
            href="http://javascriptplayground.com/blog/2012/04/javascript-variable-scope-this">scoping
            &amp; 'this' works</a>. xi4n takes advantage of it.</p>
            <p>In addition you should understand that basic idea that the
            information from LFS is received in packets.</p>
            <p>All plugins do are listen for events and then run code. Those
            events can be generated by xi4n when a packet of information is
            received and parsed, or it can be generated by another plugin.</p>

            <h3>Events <small>It's almost all in InSim.txt damnit!</small></h3>
            <p>The main events that you'll be listening for in a plugin are
            actually InSim, OutSim, Outgauge, OutSim and relay packets. Each time a
            packet is received and parsed it's emitted by name.</p>
            <p>For example the event for an IS_MSO is "IS_MSO".</p>
            <p>A full list of packets for InSim, OutSim, Outgauge and Outsim can
            be found in Insim.txt (either in &lt;LFS Path&gt;/docs/, or on the
            <a href="http://en.lfsmanual.net/wiki/InSim.txt">LFS Wiki</a>.</p>
            <p>That said, it is possible for another plugin to generated events.
            The state plugin is one such example, which most complex plugins
            will probably want to use. You can read more about it next.</p>

            <h3>Using the state meta-plugin <small>The helper plugin</small></h3>
            <p>The state plugin maintains a view of a LFS InSim connection,
            including track, weather, player connections, players racing on
            track, etc. and provides an abstracted event system that all plugins
            can use. This means that each plugin doesn't have to do this by
            itself - minimizing faults and repetition.</p>

            <table class="table table-striped" border="0">
                <thead>
                    <th>Event</th><th>Description</th>
                </thead>
            </table>

            <h3>Generating a skeleton plugin <small>The boring bits can be
            automated</small></h3>
            <p>Switch into the config directory and run the following:</p>
            <pre><code>xi4n boilerplate plugins/&lt;plugin-name&gt;</code></pre>
            <p>This generates a directory with the same name as the plugin and a
            basic package.json, and plugin file.</p>
			</article>

			<article id="config">
				<h1>Configuration File Anatomy <small>Getting up close and personal
					with config.yaml</small></h1>
				<h2 id="config-yaml">What is this YAML extension? <small>This isn't an ini file?</small></h2>
				<p>YAML (rhymes with camel) is a human-readable data
				serialization format that takes concepts from programming
				languages and ideas from XML and the data format of electronic
				mail (RFC 2822). It's designed to be easier to read than other
				configuration file formats, and simpler for the programmer to
				deal with more complex data formats than can easily be added to
				ini files.</p>
				<p>The only downside is that YAML is highly dependant on
				getting the spacing right.</p>
				<h2 id="config-tour">Got it! Take me through an example
				<small>Tour</small></h2>
				<p>The xi4n config is reasonably simple and has 3 main sections.
				Below is a very basic configuration that:</p>
				<ul>
					<li>Requires xi4n >= 0.1.0</li>
					<li>Has the state and livemap2 plugins setup to be used</li>
					<li>Has 2 connections; 1 insim and 1 LFSW relay</li>
					<li>Each connection has different logging setup</li>
					<li>Both connections share the same livemap2 plugin instance</li>
				</ul>
				<p><a href="javascript:void(0);"
				onclick="javascript:introJs().start();">Click here to take the
				tour, step by step</a>.</p>
				<noscript>
					<div class="alert">Requires javascript, sorry, but this is the best way I could
					figure out how to do this :(</div>
				</noscript>
<pre data-type="yaml"><code><span class="config-step" data-step="1" data-intro="Different versions
of xi4n maybe incompatible. We use this to say we only support versions >=
0.1.0." data-position="top">xi4n: ">=0.1.0"</span>
<span class="config-step" data-step="2" data-intro="Here we're setting up
plugins. Each plugin has it's own section. In this example we're just setting up
the state plugin." data-position="top">plugins: </span>
<span class="config-step" data-step="3" data-intro="This section contains the
setup for the state plugin. The alias is arbritary and allows you to have
multiple versions of the same plugin, with different options. The path is the
name of the plugin. The options are a list of options. In this example, there
are none." data-position="top">    - alias: state
      path: state
      options:</span>
<span class="config-step" data-step="4" data-intro="This section contains the
setup for the livemap plugin. Here we set the alias to 'mymap', and an option
called 'http-port' to 8080." data-position="top">    - alias: mymap
      path: livemap2
      options:
        http-port: 8080</span>
<span class="config-step" data-step="5" data-intro="This is arguably the most
important section. Here we setup the connections to various LFS instances. In
this example there are 2 connections, an InSim and a relay."
data-position="top">connections:
<span class="config-step" data-step="6" data-intro="This is the start of the
first connection. We're telling xi4n that this
connection is an InSim connection. xi4n can talk insim, outgauge, relay and
outsim." data-position="top">    - talk: insim</span>
<span class="config-step" data-step="7" data-intro="These are the settings for
insim. Only
insim uses these connection details. Connections talking relay, outgauge and
outsim look for different values. See the second connection below for a relay
example." data-position="top">      insim:
        over: tcp
        host: localhost
        port: 29999</span>
<span class="config-step" data-step="8" data-intro="And to use these plugins.
These are a list of each alias'ed plugin. The aliases must match to one from the
above plugin section!" data-position="top">      use:
        - state
        - mymap</span>
<span class="config-step" data-step="9" data-intro="Finally, the logging
section. You can output the log to multiple files, at multiple levels. 
The type can be console, or file. All other options are passed to the
logging engine winston. Each connection gets it's own logging engine, thus you
can have logs going to as many destinations as you wish. Ideally you'll want 1
log per connection in a production environment." data-position="top">      log:
        - level: error
          type: console
        - level: info
          type: file
          filename: error.log</span>
<span class="config-step" data-step="10" data-intro="Here's an example secondary
connection that talks to the LFSW relay. It connects to cargame.nl S2, with no admin password, uses the
same livemap plugin instance, and outputs debugging information to the console" data-position="top">    - talk: relay
      relay:
        host: cargame.nl S2
      use:
        - state
        - mymap
      log:
        - level: debug
          type: console</span></span></code></pre>

				<h2 id="config-reference">Reference</h2>
                <p><strong>TODO</strong></p>
			</article>

            <article id="library">
                <h1>Library usage <small>xi4n can be used as a library, not just
                        as a platform!</small></h1>
                <p>Sometimes using xi4n as a platform isn't ideal, it can be limiting
                and restrictive in some instances.</p>
                <p>Simply specify xi4n as a dependency in your package.json and
                npm install as you would normally, then in your code
                require('xi4n');</p>
                <h2 id="library-api">API</h2>
                <p>If you're planning on using xi4n as a library, honestly I
                highly recommend reading the source of the xi4n code. xi4n
                itself is using the same modules that you can require(), thus
                it's always going to be the most up to date repository of
                information.</p>
                <p>Now with that out of the way, require'ing xi4n will result in
                the following;</p>
                <pre data-type="javascript"><code>var xi4n = require('xi4n');
// <a href="#library-protocols">xi4n.protocols</a>
// <a href="#library-strings">xi4n.strings</a>
// <a href="#library-product">xi4n.product</a>
// <a href="#library-data">xi4n.data</a></code></pre>

                <h3 id="library-protocols">xi4n.protocols</h3>
                <h4>xi4n.protocol.insim <small>xi4n.protocol.insim(options, log)</small></h4>
                <p>Creates an instance of an insim client.</p>

                <h4>xi4n.protocol.outsim <small>xi4n.protocol.outsim(options, log)</small></h4>
                <p>Creates an instance of an outsim client.</p>

                <h4>xi4n.protocol.outgauge <small>xi4n.protocol.outgauge(options, log)</small></h4>
                <p>Creates an instance of an outgauge client.</p>

                <h4>xi4n.protocol.relay <small>xi4n.protocol.relay(options, log)</small></h4>
                <p>Creates an instance of an relay client.</p>

                <h3 id="library-strings">xi4n.strings</h3>
                <h4>xi4n.strings</h4>

                <h3 id="library-product">xi4n.product</h3>
                <h4>xi4n.product.version</h4>
                <p>Returns the semver (semantic version) of xi4n.</p>

                <h4>xi4n.product.full</h4>
                <p>Returns the full name (name-version) of xi4n.</p>

                <h3 id="library-data">xi4n.data</h3>
                <h4>xi4n.data.pth.get <small>xi4n.data.pth.get(trackname)</small></h4>
                <p>Returns a JSON encoded pth file.</p>

                <h4>xi4n.data.track.all <small>xi4n.data.track.all</small></h4>
                <p>Returns a JSON array of all tracks. Each array item is in the
                following format;</p>
                <pre><code>{ short: 'AS7', long: 'Aston North', km: 5.168,
mi: 3.211, grid: 32, s1: false, s2: true, demo: false, 
reversible: true }</code></pre>

                <h4>xi4n.data.track.findBy
                    <small>xi4n.data.track.findBy(criteria)</small></h4>
                <p>Returns an array of all tracks that match the criteria.</p>
                <p>The criteria is a callback function. For example to return
                all tracks with a distance <= 2 miles;</p>
                <pre><code>xi4n.data.track.findBy(function(i) { return i.mi <= 2; });</code></pre>

                <h4>xi4n.data.track.countBy
                    <small>xi4n.data.track.countBy(criteria)</small></h4>
                <p>Returns a count of all tracks that match the criteria.</p>
                <p>The criteria is a callback function. For example to return
                a count of all tracks with a distance <= 2 miles;</p>
                <pre><code>xi4n.data.track.countBy(function(i) { return i.mi <= 2; });</code></pre>

                <h4>xi4n.data.track.randomOneBy
                    <small>xi4n.data.track.randomOneBy(criteria)</small></h4>
                <p>Returns 1 random item of all tracks that match the criteria.</p>
                <p>The criteria is a callback function. For example to return
                a single track from any track with a distance <= 2 miles;</p>
                <pre><code>xi4n.data.track.randomOneBy(function(i) { return i.mi <= 2; });</code></pre>

                <h4>xi4n.data.vehicle</h4>
                <h4>xi4n.data.vehicle.all <small>xi4n.data.vehicle.all</small></h4>
                <p>Returns a JSON array of all vehicles. Each array item is in the
                following format;</p>
                <pre><code>{ short: 'FZR', long: 'FZ50 GTR', layout: 'Race', drive: 'RWD', kw: 465, bhp: 490, kg: 110, lb: 2425, demo: false, s1: false, s2: true }</code></pre>

                <h4>xi4n.data.vehicle.findBy
                    <small>xi4n.data.vehicle.findBy(criteria)</small></h4>
                <p>Returns an array of all vehicles that match the criteria.</p>
                <p>The criteria is a callback function. For example to return
                all vehicles with a bhp <= 55</p>
                <pre><code>xi4n.data.vehicle.findBy(function(i) { return i.bhp <= 55; });</code></pre>

                <h4>xi4n.data.vehicle.countBy
                    <small>xi4n.data.vehicle.countBy(criteria)</small></h4>
                <p>Returns a count of all vehicles that match the criteria.</p>
                <p>The criteria is a callback function. For example to return
                a count of all vehicles with a bhp <= 55;</p>
                <pre><code>xi4n.data.vehicle.findBy(function(i) { return i.bhp <= 55; });</code></pre>

                <h4>xi4n.data.vehicle.randomOneBy
                    <small>xi4n.data.vehicle.randomOneBy(criteria)</small></h4>
                <p>Returns 1 random item of all vehicles that match the criteria.</p>
                <p>The criteria is a callback function. For example to return
                a single vehicle from any vehicle with a bhp <= 55;</p>
                <pre><code>xi4n.data.vehicle.findBy(function(i) { return i.bhp <= 55; });</code></pre>

			</article>

			<article id="contributing">
                <h1>Contributing</h1>
                   <p>We're receptive to patches. Please feel free.</p>
                   <h2 id="contributing-guide">Guide <small>We're not fussy, but would be good to follow
                   some guidelines</small></h2>
				<p>Fork on <a
                    href="https://github.com/theangryangel/XI4N">the git
                    repository</a>,
                create a development branch, hack, push, submit a pull request
                (or send a patch via email).</p>
                <p>Keep your master clean. One pull request per branch, it makes
                merging easier.</p>
			</article>

		</div>
	</div>
</body>
</html>
<!-- vim: set ts=4 sw=4 tw=80 expandtab :-->
